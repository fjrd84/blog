<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Inheritance and Observer Pattern in AngularJS 1.4</title>
  <meta name="description" content="In AngularJS, when designing services, it is well common to return an instance of the $http service. The code that requests it (usually within a controller),...">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://blog.jdonado.com//angularjs/design/patterns/observer/inheritance/2016/06/12/inheritance-and-observer-pattern-in-angular-js.html">
  <link rel="alternate" type="application/rss+xml" title="JDonado - Blog" href="/feed.xml">
  
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">

    <a class="site-title" href="/">JDonado - Blog</a>

    <nav class="site-nav">
      <span class="menu-icon">
        <svg viewBox="0 0 18 15" width="18px" height="15px">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </span>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Inheritance and Observer Pattern in AngularJS 1.4</h1>
    <p class="post-meta"><time datetime="2016-06-12T20:26:53+02:00" itemprop="datePublished">Jun 12, 2016</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>In AngularJS, when designing services, it is well common to return an instance of the <strong>$http</strong> service. The code that requests it (usually within a controller), must process then the promise and do whatever it is to be done with the data that come from server.</p>

<p>Like in this example.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s1">'use strict'</span><span class="p">;</span>
<span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'exampleApp'</span><span class="p">,</span> <span class="p">[])</span>
  <span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">'ItemsService'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$http'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$http</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">getItems</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">$http</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'www.myapi-url.com/items'</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">}])</span>
  <span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">'ExampleController'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'ItemsService'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ItemsService</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">itemsList</span> <span class="o">=</span> <span class="p">[];</span> <span class="c1">// A property of the controller stores an array with items, initially empty.</span>

    <span class="nx">ItemsService</span><span class="p">.</span><span class="nx">getItems</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span>
      <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">itemsList</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"There has been an error"</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">}]);</span>            </code></pre></figure>

<p>But, sometimes you just don’t want to handle the server information in the controller, because you might need to do it in many other places in your app, and you don’t want to repeat the same code in your controllers. After all, it seems reasonable that any processing related to your items (filters, date parsing or whatever you need to do) can be encapsulated in that ItemsService, so that you can reuse it easily.</p>

<p>Specially if it is something that must be done over and over, because the API you’re working with doesn’t exactly give you back what you need or in the format that you need.</p>

<p>On the other hand, you might want to reduce the number of http requests your app performs, and storing these data as a property of the service might be convenient.</p>

<h2 id="solution-the-observer-pattern">Solution: the Observer Pattern</h2>

<p>This is why I thought it could be a good idea to implement the <a href="https://en.wikipedia.org/wiki/Observer_pattern">observer pattern</a> in angular services that retrieve information from server, store it and manipulate it in some way.</p>

<p>But if you want to implement this pattern in more than one service, it is better to define it just once and create a new service that inherits that pattern whenever necessary.</p>

<p>Since inheritance is something that can be a bit tricky when using Javascript, and even more if you want to combine it with Angular, I thought it might be useful to other people if I shared my solution.</p>

<p>I’ve created <a href="https://github.com/fjrd84/notes-app">a git repository</a> with a complete working example. Next, I’ll describe briefly how it works.</p>

<h3 id="the-observable-service-parent">The Observable Service (Parent)</h3>

<p>First, a service is declared with the functions that implement the observable pattern. But instead of returning a JSON, as usual in an AngularJS service, we return a function:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'notesApp'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">'observableService'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// A constructor is defined in order to create further services that extend this functionality</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">observerCallbacks</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="c1">//register an observer</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">registerObserverCallback</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">callback</span> <span class="o">!==</span> <span class="s2">"function"</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">observerCallbacks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
      <span class="p">};</span>
      <span class="c1">//unregister an observer</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">unregisterObserverCallback</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">found</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">observerCallbacks</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">idx</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">((</span><span class="nx">element</span> <span class="o">+</span> <span class="s1">''</span><span class="p">)</span> <span class="o">===</span> <span class="p">(</span><span class="nx">callback</span> <span class="o">+</span> <span class="s1">''</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">found</span> <span class="o">=</span> <span class="nx">idx</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">});</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">found</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">observerCallbacks</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">found</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">};</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">notifyObservers</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">angular</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">observerCallbacks</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">();</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">});</span></code></pre></figure>

<h3 id="child-observable-service">Child Observable Service</h3>

<p>Then, in order to inherit these functions, you can simply do the following (<a href="https://github.com/fjrd84/notes-app/blob/master/app/scripts/services/configuration-service.js">extract from the file configuration-service.js</a>).</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    
<span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'notesApp'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">'configurationService'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$http</span><span class="p">,</span> <span class="nx">observableService</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">configService</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="c1">// The config service inherits observable service</span>
    <span class="nx">configService</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">observableService</span><span class="p">();</span>

    <span class="nx">configService</span><span class="p">.</span><span class="nx">someNewProperty</span> <span class="o">=</span> <span class="s2">"Initial Value"</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">configService</span><span class="p">;</span>

  <span class="p">}</span></code></pre></figure>

<h3 id="inheritable-service-that-inherits-the-observableservice">Inheritable Service that Inherits the observableService</h3>

<p>If you need to create a service that inherits from the observableService, that is also inheritable by other services, you should return a function, instead of a JSON object. This is what we do in <a href="https://github.com/fjrd84/notes-app/blob/master/app/scripts/services/basic-resource.js">basic-resource.js</a>.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'notesApp'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">'basicResource'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'observableService'</span><span class="p">,</span> <span class="s1">'$http'</span><span class="p">,</span> <span class="s1">'configurationService'</span><span class="p">,</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">observableService</span><span class="p">,</span> <span class="nx">$http</span><span class="p">,</span> <span class="nx">configurationService</span><span class="p">)</span> <span class="p">{</span>

      <span class="kd">var</span> <span class="nx">basicResource</span><span class="p">;</span>

      <span class="c1">// some private variables and functions can be added here</span>
      <span class="kd">var</span> <span class="nx">privateVar</span> <span class="o">=</span> <span class="s2">"privateValue"</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">privateFunction</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(){</span>
        <span class="k">return</span> <span class="s2">"privateFunction"</span><span class="p">;</span>
      <span class="p">};</span>

      <span class="c1">// The function you return works as the constructor of your class</span>
      <span class="nx">basicResource</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// In your new constructor, you apply the constructor of the class you want to inherit</span>
        <span class="nx">observableService</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

        <span class="c1">// here you define the properties of the service</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">allElements</span> <span class="o">=</span> <span class="p">[];</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">otherPublicProperty</span> <span class="o">=</span> <span class="s2">"Initial Value"</span><span class="p">;</span>

      <span class="p">};</span>

      <span class="c1">// We inherit from observableService now</span>
      <span class="nx">basicResource</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">observableService</span><span class="p">();</span>

      <span class="k">return</span> <span class="nx">basicResource</span><span class="p">;</span>

    <span class="p">}]);</span></code></pre></figure>

<h3 id="controller-that-observes-services-that-inherit-from-observableservice">Controller that Observes Services that Inherit from observableService</h3>

<p>Now that you have observable services, you can simply define the callbacks in your controllers, and these will be updated whenever the service retrieves new information.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'notesApp'</span><span class="p">).</span><span class="nx">controller</span><span class="p">(</span><span class="s1">'MainController'</span><span class="p">,</span>
  <span class="p">[</span><span class="s1">'$scope'</span><span class="p">,</span> <span class="s1">'configurationService'</span><span class="p">,</span> <span class="s1">'notesService'</span><span class="p">,</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">configurationService</span><span class="p">,</span> <span class="nx">notesService</span><span class="p">)</span> <span class="p">{</span>
      <span class="s1">'use strict'</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

      <span class="c1">// Callback to be run when the configuration is ready</span>
      <span class="kd">var</span> <span class="nx">configurationReady</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">notesService</span><span class="p">.</span><span class="nx">loadElements</span><span class="p">();</span>
      <span class="p">};</span>

      <span class="c1">// Callbacks to update the scope when new elements are available</span>
      <span class="kd">var</span> <span class="nx">updateNotes</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">notes</span> <span class="o">=</span> <span class="nx">notesService</span><span class="p">.</span><span class="nx">allElements</span><span class="p">;</span>
      <span class="p">};</span>

      <span class="c1">// Register observer callbacks</span>
      <span class="nx">notesService</span><span class="p">.</span><span class="nx">registerObserverCallback</span><span class="p">(</span><span class="nx">updateNotes</span><span class="p">);</span>
      <span class="nx">configurationService</span><span class="p">.</span><span class="nx">registerObserverCallback</span><span class="p">(</span><span class="nx">configurationReady</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">configurationService</span><span class="p">.</span><span class="nx">isConfigurationReady</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">configurationReady</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// The observer has been registered: when ready, loadElements will be automatically called.</span>
        <span class="nx">configurationService</span><span class="p">.</span><span class="nx">loadConfiguration</span><span class="p">();</span>
      <span class="p">}</span>

    <span class="p">}]);</span></code></pre></figure>

<p>That was it. If you want to explore the complete repository, or even experiment with it and modify it, feel free to fork me on github: <a href="https://github.com/fjrd84/notes-app">https://github.com/fjrd84/notes-app</a>.</p>

  </div>

  
</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">JDonado - Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              JDonado - Blog
            
            </li>
            
            <li><a href="mailto:jdonado@jdonado.com">jdonado@jdonado.com</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/fjrd84"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">fjrd84</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/jdonado"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">jdonado</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>F. Javier R. Donado - http://www.jdonado.com
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
